<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTTP代理 - 管理控制台</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>HTTP代理 管理控制台</h1>
      <p class="subtitle">访问 <code>http://localhost:3030/{key}</code> 转发到映射的目标URL</p>
    </header>

    <div class="main-layout">
      <!-- 左侧配置区 -->
      <div class="config-panel">
        <!-- 路径映射 -->
        <section class="section collapsible">
          <div class="section-header" onclick="toggleSection(this)">
            <div class="section-title">
              <span class="collapse-icon">▼</span>
              <h2>路径映射</h2>
            </div>
            <button id="btn-add-mapping" class="btn btn-primary" onclick="event.stopPropagation()">+ 添加映射</button>
          </div>
          <div id="mappings-list" class="list section-content">
            <p class="empty">加载中...</p>
          </div>
        </section>

        <!-- 请求分组 -->
        <section class="section collapsible">
          <div class="section-header" onclick="toggleSection(this)">
            <div class="section-title">
              <span class="collapse-icon">▼</span>
              <h2>请求分组</h2>
            </div>
            <button id="btn-add-request-group" class="btn btn-primary" onclick="event.stopPropagation()">+ 添加分组</button>
          </div>
          <div id="request-groups-list" class="list section-content">
            <p class="empty">加载中...</p>
          </div>
        </section>

        <!-- 响应分组 -->
        <section class="section collapsible">
          <div class="section-header" onclick="toggleSection(this)">
            <div class="section-title">
              <span class="collapse-icon">▼</span>
              <h2>响应分组</h2>
            </div>
            <button id="btn-add-response-group" class="btn btn-primary" onclick="event.stopPropagation()">+ 添加分组</button>
          </div>
          <div id="response-groups-list" class="list section-content">
            <p class="empty">加载中...</p>
          </div>
        </section>
      </div>

      <!-- 右侧日志区 -->
      <div class="logs-panel">
        <section class="section collapsible">
          <div class="section-header" onclick="toggleSection(this)">
            <div class="section-title">
              <span class="collapse-icon">▼</span>
              <h2>请求日志</h2>
            </div>
            <div class="log-controls" onclick="event.stopPropagation()">
              <label class="auto-refresh">
                <input type="checkbox" id="auto-refresh" checked> 自动刷新
              </label>
              <button id="btn-refresh-logs" class="btn btn-secondary btn-sm">刷新</button>
              <button id="btn-clear-logs" class="btn btn-secondary btn-sm">清空日志</button>
            </div>
          </div>
          <div id="logs-list" class="logs-list section-content">
            <p class="empty">暂无请求日志</p>
          </div>
        </section>
      </div>
    </div>

    <!-- 映射编辑模态框 -->
    <div id="mapping-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="mapping-modal-title">添加映射</h3>
          <button class="btn-close" onclick="closeMappingModal()">&times;</button>
        </div>
        <form id="mapping-form">
          <input type="hidden" id="mapping-id">

          <div class="form-group">
            <label for="mapping-key">映射Key</label>
            <div class="input-with-button">
              <input type="text" id="mapping-key" required placeholder="如: iflow">
              <button type="button" id="btn-generate-key" class="btn btn-secondary btn-sm">随机生成</button>
            </div>
            <small class="hint">访问 /{key} 将转发到目标URL</small>
          </div>

          <div class="form-group">
            <label for="mapping-target">目标URL</label>
            <input type="text" id="mapping-target" required placeholder="如: https://api.example.com/v1/chat">
          </div>

          <div class="form-group">
            <label for="mapping-request-group">关联请求分组</label>
            <select id="mapping-request-group">
              <option value="">-- 不关联 --</option>
            </select>
          </div>

          <div class="form-group">
            <label for="mapping-response-group">关联响应分组</label>
            <select id="mapping-response-group">
              <option value="">-- 不关联 --</option>
            </select>
          </div>

          <div class="form-group">
            <label for="mapping-desc">描述 (可选)</label>
            <input type="text" id="mapping-desc" placeholder="描述这个映射的用途">
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="mapping-enabled" checked> 启用此映射
            </label>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn" onclick="closeMappingModal()">取消</button>
            <button type="submit" class="btn btn-primary">保存</button>
          </div>
        </form>
      </div>
    </div>

    <!-- 请求分组编辑模态框 -->
    <div id="request-group-modal" class="modal hidden">
      <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
          <h3 id="request-group-modal-title">添加请求分组</h3>
          <button class="btn-close" onclick="closeRequestGroupModal()">&times;</button>
        </div>
        <form id="request-group-form">
          <input type="hidden" id="request-group-id">

          <div class="form-group">
            <label for="request-group-name">分组名称</label>
            <input type="text" id="request-group-name" required placeholder="如: API认证">
          </div>

          <div class="form-group">
            <label for="request-group-desc">描述 (可选)</label>
            <input type="text" id="request-group-desc" placeholder="描述这个分组的用途">
          </div>

          <div class="form-group">
            <label>请求头操作</label>
            <div id="request-header-actions" class="actions-list"></div>
            <button type="button" class="btn btn-secondary" onclick="addRequestHeaderAction()">+ 添加操作</button>
          </div>

          <div class="form-group">
            <label>请求体处理</label>
            <select id="request-body-type" onchange="toggleRequestBodyConfig()">
              <option value="">不处理</option>
              <option value="script">脚本修改</option>
              <option value="replace">直接替换</option>
            </select>
            <div id="request-body-config" class="body-config hidden">
              <textarea id="request-body-content" rows="5" placeholder="脚本示例: return { ...body, newField: 'value' }"></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn" onclick="closeRequestGroupModal()">取消</button>
            <button type="submit" class="btn btn-primary">保存</button>
          </div>
        </form>
      </div>
    </div>

    <!-- 响应分组编辑模态框 -->
    <div id="response-group-modal" class="modal hidden">
      <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
          <h3 id="response-group-modal-title">添加响应分组</h3>
          <button class="btn-close" onclick="closeResponseGroupModal()">&times;</button>
        </div>
        <form id="response-group-form">
          <input type="hidden" id="response-group-id">

          <div class="form-group">
            <label for="response-group-name">分组名称</label>
            <input type="text" id="response-group-name" required placeholder="如: Mock响应">
          </div>

          <div class="form-group">
            <label for="response-group-desc">描述 (可选)</label>
            <input type="text" id="response-group-desc" placeholder="描述这个分组的用途">
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="response-mock-mode"> Mock模式 (不发起实际请求)
            </label>
          </div>

          <div class="form-group">
            <label>状态码</label>
            <input type="number" id="response-status-code" placeholder="留空则不修改" min="100" max="599">
          </div>

          <div class="form-group">
            <label>响应头操作</label>
            <div id="response-header-actions" class="actions-list"></div>
            <button type="button" class="btn btn-secondary" onclick="addResponseHeaderAction()">+ 添加操作</button>
          </div>

          <div class="form-group">
            <label>响应体处理</label>
            <select id="response-body-type" onchange="toggleResponseBodyConfig()">
              <option value="">不处理</option>
              <option value="script">脚本修改</option>
              <option value="replace">直接替换</option>
            </select>
            <div id="response-body-config" class="body-config hidden">
              <textarea id="response-body-content" rows="5" placeholder="脚本示例: return { ...body, modified: true }"></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn" onclick="closeResponseGroupModal()">取消</button>
            <button type="submit" class="btn btn-primary">保存</button>
          </div>
        </form>
      </div>
    </div>

    <!-- 全屏查看请求详情模态框 -->
    <div id="fullscreen-modal" class="modal hidden">
      <div class="modal-content fullscreen-modal-content">
        <div class="modal-header">
          <h3 id="fullscreen-modal-title">请求详情</h3>
          <button class="btn-close" onclick="closeFullscreenModal()">&times;</button>
        </div>
        <div id="fullscreen-modal-body" class="fullscreen-modal-body">
        </div>
      </div>
    </div>
  </div>

  <script src="js/admin.js"></script>
</body>
</html>
