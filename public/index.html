<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTTP代理 - 管理控制台</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>HTTP代理 管理控制台</h1>
      <p class="subtitle">访问 <code>http://localhost:3030/{key}</code> 转发到映射的目标URL</p>
    </header>

    <!-- 路径映射 -->
    <section class="section">
      <div class="section-header">
        <h2>路径映射</h2>
        <button id="btn-add-mapping" class="btn btn-primary">+ 添加映射</button>
      </div>
      <div id="mappings-list" class="list">
        <p class="empty">加载中...</p>
      </div>
    </section>

    <!-- Header分组 -->
    <section class="section">
      <div class="section-header">
        <h2>Header分组</h2>
        <button id="btn-add-group" class="btn btn-primary">+ 添加分组</button>
      </div>
      <div id="groups-list" class="list">
        <p class="empty">加载中...</p>
      </div>
    </section>

    <!-- Body分组 -->
    <section class="section">
      <div class="section-header">
        <h2>Body分组</h2>
        <button id="btn-add-body-group" class="btn btn-primary">+ 添加分组</button>
      </div>
      <div id="body-groups-list" class="list">
        <p class="empty">加载中...</p>
      </div>
    </section>

    <!-- 请求日志 -->
    <section class="section">
      <div class="section-header">
        <h2>请求日志</h2>
        <div class="log-controls">
          <label class="auto-refresh">
            <input type="checkbox" id="auto-refresh" checked> 自动刷新
          </label>
          <button id="btn-refresh-logs" class="btn btn-secondary btn-sm">刷新</button>
          <button id="btn-clear-logs" class="btn btn-secondary btn-sm">清空日志</button>
        </div>
      </div>
      <div id="logs-list" class="logs-list">
        <p class="empty">暂无请求日志</p>
      </div>
    </section>

    <!-- 映射编辑模态框 -->
    <div id="mapping-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="mapping-modal-title">添加映射</h3>
          <button class="btn-close" onclick="closeMappingModal()">&times;</button>
        </div>
        <form id="mapping-form">
          <input type="hidden" id="mapping-id">

          <div class="form-group">
            <label for="mapping-key">映射Key</label>
            <div class="input-with-button">
              <input type="text" id="mapping-key" required placeholder="如: iflow">
              <button type="button" id="btn-generate-key" class="btn btn-secondary btn-sm">随机生成</button>
            </div>
            <small class="hint">访问 /{key} 将转发到目标URL</small>
          </div>

          <div class="form-group">
            <label for="mapping-target">目标URL</label>
            <input type="text" id="mapping-target" required placeholder="如: https://api.example.com/v1/chat">
          </div>

          <div class="form-group">
            <label for="mapping-group">关联Header分组</label>
            <select id="mapping-group">
              <option value="">-- 不关联 --</option>
            </select>
          </div>

          <div class="form-group">
            <label for="mapping-body-group">关联Body分组</label>
            <select id="mapping-body-group">
              <option value="">-- 不关联 --</option>
            </select>
          </div>

          <div class="form-group">
            <label for="mapping-desc">描述 (可选)</label>
            <input type="text" id="mapping-desc" placeholder="描述这个映射的用途">
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="mapping-enabled" checked> 启用此映射
            </label>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn" onclick="closeMappingModal()">取消</button>
            <button type="submit" class="btn btn-primary">保存</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Header分组编辑模态框 -->
    <div id="group-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="group-modal-title">添加Header分组</h3>
          <button class="btn-close" onclick="closeGroupModal()">&times;</button>
        </div>
        <form id="group-form">
          <input type="hidden" id="group-id">

          <div class="form-group">
            <label for="group-name">分组名称</label>
            <input type="text" id="group-name" required placeholder="如: API认证">
          </div>

          <div class="form-group">
            <label for="group-desc">描述 (可选)</label>
            <input type="text" id="group-desc" placeholder="描述这个分组的用途">
          </div>

          <div class="form-group">
            <label>Header操作</label>
            <div id="actions-list" class="actions-list"></div>
            <button type="button" id="btn-add-action" class="btn btn-secondary">+ 添加操作</button>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn" onclick="closeGroupModal()">取消</button>
            <button type="submit" class="btn btn-primary">保存</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Body分组编辑模态框 -->
    <div id="body-group-modal" class="modal hidden">
      <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
          <h3 id="body-group-modal-title">添加Body分组</h3>
          <button class="btn-close" onclick="closeBodyGroupModal()">&times;</button>
        </div>
        <form id="body-group-form">
          <input type="hidden" id="body-group-id">

          <div class="form-group">
            <label for="body-group-name">分组名称</label>
            <input type="text" id="body-group-name" required placeholder="如: Mock响应">
          </div>

          <div class="form-group">
            <label for="body-group-desc">描述 (可选)</label>
            <input type="text" id="body-group-desc" placeholder="描述这个分组的用途">
          </div>

          <div class="form-group">
            <label>请求体处理</label>
            <select id="req-body-type" onchange="toggleBodyConfig('req')">
              <option value="">不处理</option>
              <option value="script">脚本修改</option>
              <option value="replace">直接替换</option>
            </select>
            <div id="req-body-config" class="body-config hidden">
              <textarea id="req-body-content" rows="5" placeholder="脚本示例: return { ...body, newField: 'value' }"></textarea>
            </div>
          </div>

          <div class="form-group">
            <label>响应体处理</label>
            <select id="res-body-type" onchange="toggleBodyConfig('res')">
              <option value="">不处理</option>
              <option value="script">脚本修改</option>
              <option value="replace">直接替换 (不发起请求)</option>
            </select>
            <div id="res-body-config" class="body-config hidden">
              <div id="res-status-row" class="form-row-inline hidden">
                <label>状态码</label>
                <input type="number" id="res-body-status" value="200" min="100" max="599">
              </div>
              <textarea id="res-body-content" rows="5" placeholder="脚本示例: return { ...body, modified: true }"></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn" onclick="closeBodyGroupModal()">取消</button>
            <button type="submit" class="btn btn-primary">保存</button>
          </div>
        </form>
      </div>
    </div>

    <!-- 全屏查看请求详情模态框 -->
    <div id="fullscreen-modal" class="modal hidden">
      <div class="modal-content fullscreen-modal-content">
        <div class="modal-header">
          <h3 id="fullscreen-modal-title">请求详情</h3>
          <button class="btn-close" onclick="closeFullscreenModal()">&times;</button>
        </div>
        <div id="fullscreen-modal-body" class="fullscreen-modal-body">
        </div>
      </div>
    </div>
  </div>

  <script src="js/admin.js"></script>
</body>
</html>
